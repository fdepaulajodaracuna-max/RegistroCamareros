<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Dashboard Camarero</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-right">
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Hola, {{ session.get('camarero_nombre') }}</h2>
    <div>
      <a href="{{ url_for('camarero_logout') }}" class="btn btn-danger">Cerrar sesión</a>
      <a href="{{ url_for('home') }}" class="btn btn-secondary">Inicio</a>
    </div>
  </div>

  <div class="card p-3 mb-4">
    <h4>Nuevo registro</h4>
    <form method="POST">
      <div class="row">
        <div class="col-md-4 mb-2"><label>Fecha</label><input type="date" name="fecha" class="form-control" required></div>
        <div class="col-md-4 mb-2"><label>Hora entrada</label><input type="time" name="hora_entrada" class="form-control" required></div>
        <div class="col-md-4 mb-2"><label>Hora salida (opcional)</label><input type="time" name="hora_salida" class="form-control"></div>
      </div>
      <div class="form-check my-2">
        <input class="form-check-input" type="checkbox" name="coche" id="coche">
        <label class="form-check-label" for="coche">He usado coche</label>
      </div>
      <button class="btn btn-primary">Guardar</button>
    </form>
  </div>

  <h5>Tus registros</h5>
  <table class="table table-striped">
    <thead><tr><th>Fecha</th><th>Entrada</th><th>Salida</th><th>Coche</th><th>Horas</th><th>€ ese día</th></tr></thead>
    <tbody>
      {% for r in registros %}
      {% set horas = ( ( (r['hora_salida'] and r['hora_entrada']) and ( ( ( ( (r['hora_salida']|default(''))!='' ) and ( (r['hora_entrada']|default(''))!='' ) ) ) ) ) ) %}
      <tr>
        <td>{{ r['fecha'] }}</td>
        <td>{{ r['hora_entrada'] }}</td>
        <td>{{ r['hora_salida'] or '-' }}</td>
        <td>{{ 'Sí' if r['coche'] else 'No' }}</td>
        <td>
          {% if r['hora_entrada'] and r['hora_salida'] %}
            {{ ('%.2f' % (( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( (r['hora_salida'][:2]|int)*60 + r['hora_salida'][3:5]|int) - (r['hora_entrada'][:2]|int)*60 + r['hora_entrada'][3:5]|int) ) )/60.0) if ((r['hora_salida'][:2]|int)*60 + r['hora_salida'][3:5]|int) >= ((r['hora_entrada'][:2]|int)*60 + r['hora_entrada'][3:5]|int) ) else ( ((r['hora_salida'][:2]|int)*60 + r['hora_salida'][3:5]|int) + 24*60 - ((r['hora_entrada'][:2]|int)*60 + r['hora_entrada'][3:5]|int) ) ) ) ))) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) }}
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          {% if r['hora_entrada'] and r['hora_salida'] %}
            {% set minutos_ent = r['hora_entrada'][:2]|int * 60 + r['hora_entrada'][3:5]|int %}
            {% set minutos_sal = r['hora_salida'][:2]|int * 60 + r['hora_salida'][3:5]|int %}
            {% set dur_min = (minutos_sal - minutos_ent) if minutos_sal >= minutos_ent else (minutos_sal + 24*60 - minutos_ent) %}
            {% set horas_f = dur_min / 60.0 %}
            {{ '%.2f' % (horas_f * tarifa + (r['extra_coche'] or 0)) }}
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
</body>
</html>
